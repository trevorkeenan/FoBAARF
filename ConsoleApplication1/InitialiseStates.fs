module InitialiseStates
open FoBAARTypes

let DefineDefaultPars = 
    {litToSom= -3.57979; //-4.07416;
    gppresp=0.101896; //0.178775;
    allocLeaf=0.121949; //0.183202;
    allocRoot=0.608847; //0.705791;
    litFallR= -0.753413; //-0.861879;
    woodFallR= -6.3581; //-7.45223;
    rootFallR= -5.63547; //-7.72468;
    litResp= -5.78274; //-4.18184;
    rh1= -4.37119; //-5.69394;
    litRespT=0.08842469; //6.52E-02;
    litToSOMT=0.06106346; //6.98E-02;
    winterEndDay=220.794; //258.653;
    leafDropTemp=4.24086; //4.24001;
    fracLab=0.159097; //0.402818;
    cfromLab= -1.14865; //-1.00385;
    swhC=156.703; //9999.0;
    drainage=0.004191259; //9999.0;
    rootResp= -3.28898; //-3.6193;
    Cr=54.9293; //52.177;
    Cw=4019.25; //4474.11;
    Clit=626.064; //204.515;
    Csom1=91.0306; //103.653;
    Clab=184.67; //107.827;
    LMA=84.9095; //82.0714;
    GDDstart=95.3179; //96.1821;
    rh2= -8.86444; //-8.30624;
    Phen=277.944; //395.599;
    SOMrespT=0.06065661; //5.31E-02;
    RootRespT=0.05032701; //0.157374;
    Vcmax=84.0582; //88.3841;
    gSD0=0.995257; //1.05497;
    tetaph=0.561463; //0.524161;
    tadj1=19.3073; //19.2823;
    g1=6.1386; //112.28;
    S1tS2=0.545223; //0.100453;
    RdOrig=0.857493; //0.729575;
    Q10Rd=1.14533; //1.02862;
    SoilR1=1.44696; //1.41799;
    SoilR2=1.48292; //1.44435;
    SoilR3=1.44923; //1.46737;
    S1tS2T=0.159677; //0.117676;
    Csom2=3706.68; //4393.39;
    Csom3=4709.45; //3983.43;
    rh3= -10.404; //-10.1031;
    S2tS3=0.361109} // 0.197363

let SetSiteHes = 
    let stDay=1
    let stDayCal = stDay
    let nDayCal = stDay+365*1
    let nDay = nDayCal+0
    let nYears=nDay/365
    let subDaily=48.0
    let period=24.0/subDaily
    {stDay=stDay;
    stDayCal=stDayCal;
    nDayCal=nDayCal;
    nDay=nDay;
    nYears=nYears;
    subDaily=subDaily;
    period=period; 
    siteName="FRHes";
    lat=0.79;// 45.25 degrees converted to radians.
    phenology=1; //says whether this site is deciduous (1) or evergreen (0)
    numSoilPools=3;
    decidflag=1;
    Nit = 45.25;
    LMA=3.1;
    Xfang=0.5;
    EaVcmax= 76459.0;
    EdVcmax=220121.0;
    EaJmax= 44370.0;
    EdJmax= 213908.0;
    SJmax= 710.0}

let InitStateSimulation pars site= 
    let Cf = 
        if (site.phenology=1) then
            0.0
        else
            pars.winterEndDay
    let Cr=pars.Cr
    let Cw=pars.Cw
    let Clit = pars.Clit
    let Clab = pars.Clab
    let swc=pars.swhC
    let cSOMPool1 = pars.Csom1
    let cSOMPool2 = pars.Csom2
    let cSOMPool3 = pars.Csom3
    let bSoilMeas1 = pars.SoilR1
    let bSoilMeas2 = pars.SoilR2
    let bSoilMeas3 = pars.SoilR3
    let soilWater = pars.swhC
    let stateOut = {Cr=Cr;
        Cw=Cw;  
        Clit=Clit;
        Clab=Clab;
        Ar=0.0;
        Lr=0.0;
        soilWater=soilWater;
        cSOMPool1=cSOMPool1;
        cSOMPool2=cSOMPool2;
        cSOMPool3=cSOMPool3;
        G=0.0;
        iGPP=0.0;
        iNEE=0.0;
        iRa=0.0;
        iDresp=0.0;
        iRoot=0.0;
        iRh=0.0;
        iRhLit=0.0;
        iRh1=0.0;
        iRh2=0.0;
        iRh3=0.0;
        iD1=0.0;
        iD2=0.0;
        iDLit=0.0;
        iRsoil=0.0;
        iLw=0.0;
        atolab=0.0;
        afromlab=0.0;
        Lf2=0.0;
        ca=358.0;
        leafout=0.0; //gets updated// could be int       
        leafin = 0.0;//gets updated // could be int
        year = 0.0;
        dayOfYear = 1.0;// check what we start on                    
        timeStepsElapsed=0;
        hourInDay=0.5;
        Cf=Cf;
        totLAI=0.0;// need to fix
        Tadj=0.0;// This gets updated. Accounts for seasonal variation in VcMax
        Tadj2=0.0;// This gets updated. Additional seasonality to respiration - coupled to photosynthesis during the season.
        gdd=0.0;
        gdd1 = 0.0;
        gdd2=0.0;
        GDaily=0.0;
        GDaily2=0.0;
        GcDaily=0.0;
        GcDaily2=0.0;
        ETDaily=0.0;
        DrespDaily=0.0;
        RaDaily=0.0;
        RhLitDaily=0.0;
        Rh1Daily=0.0;
        Rh2Daily=0.0;
        Rh3Daily=0.0;
        RrootDaily=0.0;
        RsoilModDaily=0.0;
        ralabtoDaily=0.0;
        ralabfromDaily=0.0;
        radDaily=0.0;
        fAparDaily=0.0;
        multtf=0.0;
        multtl=0.0;
        NEEDaily=0.0;
        precipDaily=0.0}
    stateOut

let InitStateDay (state:stateVector) pars site = 
    {state with
        hourInDay=0.5;
        GDaily=0.0;
        GDaily2=0.0;
        GcDaily=0.0;
        GcDaily2=0.0;
        ETDaily=0.0;
        DrespDaily=0.0;
        RaDaily=0.0;
        RhLitDaily=0.0;
        Rh1Daily=0.0;
        Rh2Daily=0.0;
        Rh3Daily=0.0;
        RrootDaily=0.0;
        RsoilModDaily=0.0;
        ralabtoDaily=0.0;
        ralabfromDaily=0.0;
        NEEDaily=0.0;
        radDaily=0.0;
        fAparDaily=0.0;
        precipDaily=0.0}

let InitStateYear state pars site= 
    {state with 
        leafin = 0.0;//gets updated // could be int
        leafout=0.0; //gets updated// could be int
        year=state.year+1.0;
        dayOfYear = 1.0;
        iGPP = 0.0;
        iNEE = 0.0;
        iRa = 0.0;
        iDresp=0.0;
        iRoot=0.0;
        iRh = 0.0;
        iRhLit=0.0;
        iRh1 = 0.0;
        iRh2 = 0.0;
        iRh3 = 0.0;
        iD1=0.0;
        iD2=0.0;
        iDLit=0.0;
        iRsoil = 0.0;
        iLw=0.0;
        Lf2=0.0}
